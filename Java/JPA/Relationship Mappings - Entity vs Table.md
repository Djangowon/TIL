# Relationship Mappings - Entity vs Table

<br>
<br>


> 객체를 테이블에 맞추어 데이터 중심으로 모델링하면, 협력 관계를 만들 수 없음  
> `테이블은 외래 키로 조인`을 사용해서 연관된 테이블을 찾고, `객체는 참조`를 사용해서 연관된 객체를 찾음


## 단방향 연관관계
* 예를 들어 회원 객체와 팀 객체가 ManyToOne 연관관계 일 때, 회원은 Member.team 을 통해 팀을 알 수 있지만, 반대로 팀은 회원을 조회할 수 없음
* 한 쪽에서만 조회가 가능한 단방향 연관관계



<br>
<br>


## 양방향 연관관계와 연관관계의 주인
* 테이블의 연관관계는 외래 키 하나로 양방향 조인이 가능함, 사실상 테이블 연관관계는 방향이라는 개념 자체가 없음
* 양방향 객체 연관관계는 예를 들어 ManyToOne일 때, Many 쪽에 One의 객체를 주고, One 쪽에 Many 리스트를 설정해줌


* 객체는 가급적이면 단방향이 좋음, 양방향이면 더 신경쓸 게 많음



<br>
<br>


## 객체와 테이블이 관계를 맺는 차이
* 객체 연관관계는 2개
	* 객체의 양방향 관계는 사실 양방향 관계가 아니라, 서로 다른 단방향 연관관계가 2개 있다고 보면 됨
* 테이블 연관관계는 1개
	* 다대일 관계 중 다 쪽에 있는 FK 외래키 값 하나로 두 테이블의 연관관계를 관리함


<br>
<br>


## 연관관계의 주인(Owner)
* 양방향 매핑 규칙
	* 객체의 두 관계중 하나를 연관관계의 주인으로 지정해야 함
	* 연관관계의 주인만이 외래 키를 관리할 수 있음(등록, 수정)
	* 주인이 아닌 쪽은 읽기만 가능
	* 주인은 mappedBy 속성 사용하면 안 됨
	* 주인이 아니면 mappedBy 속성으로 주인 지정해줘야 함
* 외래 키가 있는 곳을 주인으로 정할 것(N쪽이 무조건 연관관계의 주인이 되게끔)



<br>
<br>


## 양방향 매핑시 연관관계의 주인에 값을 입력해야 함
* 순수한 객체 관계를 고려하면 항상 양쪽 다 값을 입력해주는 게 맞음
* 연관관계 편의 메소드 생성해서 쓸 것-> 연관관계 어느 쪽에 주든 한 쪽만 줄 것
* 양방향 매핑시에 무한 루프 조심해야 함
	* toString(), lombok, JSON 생성 라이브러리
	
<br>
	 
### 컨트롤러에서는 Entity 반환하면 안 되는 이유
* 무한루프가 생길 가능성이 있음
* 단순하게 값만 있는 Dto로 변환해서 반환하는 것을 권장함
	> Entity는 필드가 추가되는 등 다양한 변경 가능성이 있기 때문에 Entity를 API로 반환하게 되면 Entity를 변경하는 순간 API 스펙이 바뀌는 것임
		

<br>
<br>


## 양방향 매핑 정리
* 단방향 매핑만으로도 이미 연관관계 매핑은 완료임
* 양방향 매핑은 반대 방향으로 조회(객체 그래프 탐색) 기능이 추가된 것 뿐임
* JPQL에서 역방향으로 탐색할 일이 많음
* 단방향 매핑을 잘 하고 양방향은 필요할 때 추가해도 됨(테이블에 영향을 주지 않음)


<br>
<br>


## Ref
https://www.inflearn.com/course/ORM-JPA-Basic
