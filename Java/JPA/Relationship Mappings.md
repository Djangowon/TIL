# Relationship Mappings - N:1, 1:N, 1:1, N:M


<br>
<br>


## 연관관계 매핑시 고려사항 3가지
* 다중성
	* 다대일 : @ManyToOne
	* 일대다: @OneToMany
	* 일대일: @OneToOne
	* 다대다: @ManyToMany
		* 다대다는 비추천

* 단방향, 양방향
* 연관관계의 주인


<br>
<br>


## 다대일 단방향
* 다쪽에 외래 키를 넣어줘야 함
* 가장 많이 사용하는 연관관계


<br>
<br>


## 일대다 단방향
* 일대다 단방향은 일이 연관관계의 주인임
* 테이블 일대다 관계는 항상 다 쪽에 외래 키가 있기 때문에 객체와 테이블의 차이로 인해서 반대편 테이블의 외래 키를 관리하는 특이한 구조임
	* 엔티티가 관리하는 외래 키가 다른 테이블에 있다는 게 큰 단점, 연관관계 관리를 위해 추가로 업데이트 SQL이 실행됨
* @JoinColumn을 꼭 사용해야 하고, 아니면 중간 테이블을 추가해야 함
* 일대다는 비추천하는 방식
	> 객체지향 적으로 손해를 보더라도 다대일 단방향을 채택하고 필요하면 양방향을 추가해서 사용하는 게 유지보수하기도 쉽고 ORM보다는 DB에 맞게 설계하는 방법임



<br>
<br>


## 일대일 관계
* 일대일 관계는 그 반대도 일대일
* 주 테이블이나 대상 테이블 중에 외래 키 선택 가능함
	* 주 테이블에 외래 키
	* 대상 테이블에 외래 키
* 외래 키에 데이터베이스 유니크 제약조건 추가

<br>

### 일대일 : 주 테이블에 외래 키 단방향, 양방향
* 가장 심플한 일대일 연관관계 매핑방법
* 다대일 양방향 매핑처럼 외래 키가 있는 곳이 연관관계의 주인임
* 반대편에 mappedBy 써줘야 함
* 객체지향 개발자가 선호하는 방식, JPA 매핑이 편리함
* 주 테이블만 조회해도 대상 테이블에 데이터가 있는지 확인 가능함, 데이터가 없다면 외래 키에 null 을 허용함

<br>

### 일대일 : 대상 테이블에 외래 키 단방향, 양방향
* 대상 테이블에 외래 키가 있는 단방향 관계는 JPA에서 지원하지 않음, 양방향 관계만 지원함
* 일대일 주 테이블에 외래 키 양방향과 같은 매핑 방법
* 전통적인 데이터베이스 개발자가 선호하는 방식
* 미래에 비즈니스가 바뀌어서 주 테이블과 대상 테이블이 일대일에서 일대다로 변경되는 경우 테이블 구조를 유지할 수 있음
* 프록시 기능의 한계로 지연 로딩으로 설정해도 항상 즉시 로딩됨
	> 대상 테이블에 외래 키가 있으면 주 테이블만 조회해서는 안됨, 추가로 대상 테이블을 조회하고 대상 테이블이 가진 외래 키가 찾는 주 테이블의 아이디와 같은지 확인해야 하는 등의 SQL 쿼리가 한번 더 쓰여야 함


<br>
<br>

	
## 다대다
* 관계형 데이터베이스는 정규화된 테이블 2개로는 다대다 관계를 표현할 수 없기 때문에 중간 테이블을 추가해서 일대다 또는 다대일 관계로 풀어내야 함
* 객체는 데이터베이스와 달리 List 컬렉션을 사용해서 객체 2개로 다대다 관계가 가능함
* @ManyToMany 사용
* @JoinTable로 연결 테이블 지정해야 함

<br>

* 다대다의 중간 테이블이 단순히 연결만 하고 끝나지 않고, 추가 데이터가 들어올 수 있는 확장성을 고려해야 하기 때문에 ManyToMany 자체로는 실무에서 사용하기에 어려운 점이 많음
	> 필드를 추가할 수 없고, 엔티티 테이블이 불일치할 수 있기 때문에
* 연결 테이블을 엔티티로 승격해서 사용하는 게 방법임
	* @ManyToMany -> @OneToMany, @ManyToOne



<br>
<br>

## Ref
https://www.inflearn.com/course/ORM-JPA-Basic
